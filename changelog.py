import git
import semantic_release
from semantic_release import ParserOptions
from semantic_release.enums import LevelBump


class PythonSDKCommitParser(
    semantic_release.CommitParser[semantic_release.ParseResult, semantic_release.ParserOptions]
):
    parser_options = ParserOptions

    def parse(self, commit: "git.objects.commit.Commit") -> "semantic_release.ParseResult":
        if (
            "generated by python-semantic-release" in commit.message
            or commit.message.startswith("Merge pull request")
            or commit.message.startswith("Merge branch")
        ):
            return semantic_release.ParseError(commit=commit, error="Inappropriate commit message")
        return semantic_release.ParsedCommit(
            bump=LevelBump.MINOR,
            type="feature",
            descriptions=[commit.message],
            breaking_descriptions=[],
            commit=commit,
            scope="",
        )
